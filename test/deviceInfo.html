<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Media Device info</title>
</head>
<body>
<div>
    <p>Click below to get camera info. Make sure to accept permissions</p>
    <button id="startBtn">Scan devices</button>
    <p>
        <span id="statusText"></span>
    </p>
</div>
<div id="deviceInfoText"></div>

<script>
    let deviceInfo = document.getElementById('deviceInfoText');
    let startBtn = document.getElementById('startBtn');
    let status = document.getElementById('statusText');

    let mobileDevices = [];

    function gotDevices(deviceInfos){
        deviceInfos.every(async deviceInfo=>{
            let span = document.createElement("span");
            let text = "";
            let infoObj = deviceInfo.toJSON();
            let keys = Object.keys(deviceInfo.toJSON());
            keys.forEach(key=>text+=`${key}: ${infoObj[key]}\n`);

            function showSettings(track){
                let settings = track.getSettings();
                console.log(settings);
                text += `Default ${infoObj.kind} track settings:\n`;
                Object.keys(settings).forEach(key=>text+=` - ${key}: ${settings[key]}\n`);
                track.stop();

                if(settings.facingMode){
                    mobileDevices.push(infoObj.deviceId);
                    status.innerText = "Mobile device";
                }
            }

            if(infoObj.deviceId !== ""){
                if(infoObj.kind==="videoinput"){
                    let stream = await navigator.mediaDevices.getUserMedia({video: {deviceId: {exact: infoObj.deviceId}}});
                    stream.getVideoTracks().forEach(showSettings);
                    stream = null;
                }

                if(infoObj.kind==="audioinput"){
                    let stream = await navigator.mediaDevices.getUserMedia({audio: {deviceId: {exact: infoObj.deviceId}}});
                    stream.getAudioTracks().forEach(showSettings);
                    stream = null;
                }
            } else {
                status.innerText = "Device permissions not granted. Accept and try again.";
                // Get permission
                let stream = await navigator.mediaDevices.getUserMedia({audio: true, video: true});
                stream.getTracks().forEach(track=>track.stop());
                return false;
            }

            span.innerText = text;
            deviceInfo.appendChild(document.createElement("hr"));
            deviceInfo.appendChild(span);
            return true;
        });
    }

    startBtn.onclick = ()=>{
        deviceInfo.innerHTML = ""; //clear this incase of multiple runs;
        navigator.mediaDevices.enumerateDevices().then(gotDevices).catch(err=>console.error(err));
    }

</script>
</body>
</html>
